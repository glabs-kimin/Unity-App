<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>경기도 Unity MVP (v1.6)</title>
    <style>
        /* CSS는 이전 v1.5 버전과 동일합니다. */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        :root { --primary-blue: #0A2C4A; --accent-warm: #FFB836; --text-dark: #333333; --text-light: #777777; --bg-light: #f8f9fa; --white: #ffffff; --border-color: #e9ecef; }
        body { font-family: 'Noto Sans KR', sans-serif; margin: 0; background-color: #ccc; display: flex; justify-content: center; padding: 20px 0; }
        .phone-container { width: 375px; height: 812px; background-color: var(--white); box-shadow: 0 0 20px rgba(0,0,0,0.1); border-radius: 40px; overflow: hidden; border: 10px solid #111; display: flex; flex-direction: column; }
        .content-scroll { flex-grow: 1; overflow-y: auto; background-color: var(--bg-light); }
        .screen { padding: 20px; }
        h2, h3 { color: var(--primary-blue); margin-top: 0; }
        .program-card { background: var(--white); border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; padding: 15px; }
        .bottom-nav { display: flex; justify-content: space-around; background-color: var(--white); border-top: 1px solid var(--border-color); padding: 10px 0; width: 100%; }
        .nav-btn { text-align: center; font-size: 12px; color: var(--text-light); cursor: pointer; flex-grow: 1; }
        .nav-btn.active { color: var(--accent-warm); font-weight: 700; }
        /* 기타 스타일은 생략... */
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="content-scroll">
            
            <div id="auth-screen" class="screen"> </div>
            <div id="main-screen" class="screen" style="display:none;"> </div>
            <div id="program-list-screen" class="screen" style="display:none;"> </div>

            <div id="my-bookings-screen" class="screen" style="display:none;">
                <header class="main-header">
                    <div class="logo">나의 예약 현황</div>
                </header>
                <main id="my-bookings-list-page">
                    </main>
            </div>
            
            <div id="pass-screen" class="screen" style="display:none; text-align: center;"> </div>
        </div>
        <footer class="bottom-nav" style="display:none;">
            <div class="nav-btn" id="nav-home">홈</div>
            <div class="nav-btn" id="nav-programs">전체 프로그램</div>
            <div class="nav-btn" id="nav-my-bookings">내 예약</div>
            <div class="nav-btn" id="nav-my-page">마이페이지</div>
        </footer>
    </div>

    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
      // ... firebaseConfig ...

      // Firebase 초기화
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
      
      // --- HTML 요소들 ---
      const screens = {
        auth: document.getElementById('auth-screen'),
        main: document.getElementById('main-screen'),
        programList: document.getElementById('program-list-screen'),
        myBookings: document.getElementById('my-bookings-screen'),
        pass: document.getElementById('pass-screen')
      };
      const navButtons = {
        home: document.getElementById('nav-home'),
        programs: document.getElementById('nav-programs'),
        myBookings: document.getElementById('nav-my-bookings'),
        myPage: document.getElementById('nav-my-page')
      };
      // ... 나머지 요소들 ...

      // --- 함수 정의 ---

      // 화면 전환 함수
      function showScreen(screenKey) {
        Object.values(screens).forEach(screen => screen.style.display = 'none');
        screens[screenKey].style.display = 'block';

        Object.values(navButtons).forEach(btn => btn.classList.remove('active'));
        if (navButtons[screenKey]) {
            navButtons[screenKey].classList.add('active');
        } else if (screenKey === 'pass') {
            // 출입증 화면은 특정 탭에 속하지 않음
        } else {
            navButtons.home.classList.add('active'); // 기본값
        }
      }

      // 예약 목록 표시 함수 (컨테이너 ID를 인자로 받음)
      function displayBookings(userId, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;
        container.innerHTML = '로딩 중...';
        // ... (이전과 동일한 예약 목록 불러오기 로직) ...
      }

      // ... generateAccessPass 함수는 이전과 동일 ...


      // --- 이벤트 리스너 및 상태 관리 ---

      auth.onAuthStateChanged(user => {
        if (user) {
          showScreen('main'); // 로그인 시 메인 화면으로
          bottomNav.style.display = 'flex';
          // ... 웰컴 메시지 ...
          // 두 곳 모두에 예약 목록을 불러옴
          displayBookings(user.uid, 'my-bookings-list'); 
          displayBookings(user.uid, 'my-bookings-list-page');
        } else {
          showScreen('auth'); // 로그아웃 시 인증 화면으로
          bottomNav.style.display = 'none';
        }
      });
      
      // 하단 네비게이션 버튼 클릭 이벤트
      navButtons.home.addEventListener('click', () => showScreen('main'));
      navButtons.programs.addEventListener('click', () => showScreen('programList'));
      navButtons.myBookings.addEventListener('click', () => showScreen('myBookings'));
      // navButtons.myPage.addEventListener('click', () => ...); // 다음 구현 과제

      // ... 기타 모든 버튼 이벤트 리스너는 이전과 동일 ...
      
    </script>
</body>
</html>